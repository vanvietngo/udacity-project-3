# - name: "Creates directory"
#   file:
#     path: "~/server"
#     state: "directory"
#     mode: 0755

# - name: "Copy compressed backend folder"
#   copy:
#     src: "~/project/artifact.tar.gz"
#     dest: "~/server/artifact.tar.gz"

# - name: "Extract backend"
#   unarchive:
#     remote_src: yes
#     src: "~/server/artifact.tar.gz"
#     dest: "~/server"

# - name: "Run the web server"
#   shell:
#     cmd: |
#       cd ~/server
#       npm install
#       pm2 stop default
#       pm2 start npm -- start --wait-ready



# ---
# - name: "Creates backend app directory"
#   file:
#     path: ~/backend-app
#     state: directory

# - name: "Unarchive backend files"
#   unarchive:
#     src: artifact.tar.gz
#     dest: ~/backend-app

# - name: "Installing Node Dependencies"
#   shell: |
#     cd ~/backend-app
#     npm i

# - name: "Executing Node app with PM2"
#   shell: |
#     cd ~/backend-app
#     pm2 stop default
#     pm2 start npm -- start

#   register: execute_node

# - name: print message
#   debug:
#     msg: "{{ execute_node.stdout_lines }}"

# - name: "Configure pm2 to start as service"
#   shell: |
#     sudo su -c "env PATH=$PATH:/usr/local/bin pm2 startup systemd -u ubuntu --hp /home/ubuntu"
#     pm2 save


---

- name: "Create backend directory"
  file:
    path: "~/backend"
    state: "directory"
    mode: 0755




- name: "Copy build folder"
  copy:
    src: "../../artifact.tar.gz"
    dest: "~/backend/artifact.tar.gz"




- name: "Extract build folder"
  unarchive:
    remote_src: yes
    src: "~/backend/artifact.tar.gz"
    dest: "~/backend"




- name: "Start server"
  shell:
    cmd: |
      cd ~/backend
      npm install
      pm2 stop default
      pm2 start npm -- start